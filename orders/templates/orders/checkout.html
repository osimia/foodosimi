<!-- templates/orders/checkout.html -->

{% extends "base.html" %}

{% block content %}
<div class="max-w-2xl mx-auto p-6 bg-white rounded-lg shadow-md">
  <h1 class="text-2xl font-bold mb-2 text-blue-600">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h1>
  
  {% if not user.is_authenticated %}
  <div class="mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
    <p class="text-sm text-blue-800">
      <span class="font-medium block mb-1">üëã –ë—ã—Å—Ç—Ä–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</span>
      –£–∫–∞–∂–∏—Ç–µ –≤–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞. –ï—Å–ª–∏ –≤—ã —É –Ω–∞—Å –≤–ø–µ—Ä–≤—ã–µ, –º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–¥–∏–º –¥–ª—è –≤–∞—Å –∞–∫–∫–∞—É–Ω—Ç. –ï—Å–ª–∏ –≤—ã —É–∂–µ –æ—Ñ–æ—Ä–º–ª—è–ª–∏ –∑–∞–∫–∞–∑—ã —Ä–∞–Ω–µ–µ, –º—ã —Å–≤—è–∂–µ–º —ç—Ç–æ—Ç –∑–∞–∫–∞–∑ —Å –≤–∞—à–∏–º –∞–∫–∫–∞—É–Ω—Ç–æ–º.
    </p>
  </div>
  {% endif %}
  
  {% if messages %}
    {% for message in messages %}
      <div class="mb-4 p-3 rounded-lg {% if message.tags == 'error' %}bg-red-500{% else %}bg-green-500{% endif %} text-white">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <div class="mb-6 bg-white border border-gray-100 p-6 rounded-lg shadow-sm">
    <h2 class="text-lg font-semibold mb-4 border-b pb-2 flex items-center">
      <span class="mr-2">üßæ</span> –í–∞—à –∑–∞–∫–∞–∑
    </h2>
    
    <ul class="space-y-3 mb-4">
      {% for item in cart_items %}
        <li class="flex justify-between items-center py-2 {% if not forloop.last %}border-b border-gray-100{% endif %}">
          <div class="flex items-start">
            <div class="w-10 h-10 bg-gray-50 rounded-md flex items-center justify-center text-gray-400 mr-3">
              {% if item.product.images.first %}
                <img src="{{ item.product.images.first.get_direct_s3_url }}" alt="" class="w-10 h-10 object-cover rounded-md">
              {% else %}
                <span class="text-sm">–ù–µ—Ç —Ñ–æ—Ç–æ</span>
              {% endif %}
            </div>
            <div>
              <span class="font-medium text-gray-800">{{ item.product.name }}</span>
              {% if item.size %}
                <span class="text-xs text-gray-500 block">–†–∞–∑–º–µ—Ä: {{ item.size }}</span>
              {% endif %}
            </div>
          </div>
          <div class="text-right">
            <div class="font-medium text-gray-900">{{ item.product.price|floatformat:2 }} —Å.</div>
            <div class="text-xs text-gray-500">{{ item.quantity }} —à—Ç.</div>
          </div>
        </li>
      {% endfor %}
    </ul>
    
    <div class="border-t border-gray-100 mt-3 pt-4">
      <div class="flex justify-between items-center mb-2">
        <span class="text-gray-600">–¢–æ–≤–∞—Ä–æ–≤:</span>
        <span>{{ cart_items|length }} —à—Ç.</span>
      </div>
      <div class="flex justify-between items-center mb-2">
        <span class="text-gray-600">–î–æ—Å—Ç–∞–≤–∫–∞:</span>
        <span class="text-green-600">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
      </div>
      <div class="flex justify-between items-center font-bold text-lg pt-2 border-t border-gray-100 mt-2">
        <span>–ò—Ç–æ–≥–æ:</span>
        <span>{{ total|floatformat:2 }} —Å–æ–º–æ–Ω–∏</span>
      </div>
    </div>
  </div>

  <form method="post" class="space-y-4">
    {% csrf_token %}
    
    <div class="mb-4">
      <label class="block text-gray-700 mb-2 font-medium">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞*</label>
      <input type="tel" name="phone" 
             class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
             placeholder="+7 (XXX) XXX-XX-XX" 
             value="{{ user.phone|default:'' }}"
             {% if user.is_authenticated and user.phone %}readonly{% endif %}
             required>
      <p class="text-sm text-gray-500 mt-1">
        {% if not user.is_authenticated %}
        –≠—Ç–æ—Ç –Ω–æ–º–µ—Ä –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤
        {% else %}
        –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
        {% endif %}
      </p>
    </div>
    
    <div class="mb-4">
      <label class="block text-gray-700 mb-2 font-medium">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏*</label>
      <textarea name="delivery_address" rows="3"
                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                placeholder="–ì–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞" required></textarea>
    </div>
    
    <button type="submit"
            class="w-full bg-green-600 text-white font-semibold py-3 rounded-lg hover:bg-green-700 transition flex items-center justify-center">
      <span class="mr-2">‚úÖ</span> –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑
    </button>
    
    <p class="text-sm text-gray-600 mt-4 text-center">
      {% if not user.is_authenticated %}
      –ü–æ—Å–ª–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ª–∏—á–Ω–æ–º—É –∫–∞–±–∏–Ω–µ—Ç—É –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞.<br>
      {% endif %}
      –ù–∞–∂–∏–º–∞—è –∫–Ω–æ–ø–∫—É "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑", –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å —É—Å–ª–æ–≤–∏—è–º–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –æ–ø–ª–∞—Ç—ã.
    </p>
  </form>
</div>
{% endblock %}
