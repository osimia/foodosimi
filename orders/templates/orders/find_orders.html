{% extends "base.html" %}

{% block content %}
<div class="max-w-5xl mx-auto">
  <div class="bg-gradient-to-r from-blue-500 to-blue-700 mb-6 p-8 rounded-lg shadow-lg text-white">
    <div class="flex justify-between items-center">
      <div>
        <h1 class="text-3xl font-bold">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h1>
        <p class="text-blue-100">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∑–∞–∫–∞–∑–æ–≤</p>
      </div>
    </div>
  </div>
  
  {% if messages %}
    {% for message in messages %}
      <div class="mb-4 p-4 rounded-lg shadow-md text-white {% if message.tags == 'success' %}bg-green-500{% else %}bg-red-500{% endif %} border-l-4 {% if message.tags == 'success' %}border-green-700{% else %}border-red-700{% endif %}">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}
  
  <div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <div class="text-center py-6">
      <div class="w-20 h-20 rounded-full bg-blue-100 flex items-center justify-center text-blue-500 text-4xl mx-auto mb-4">
        üì±
      </div>
      <h2 class="text-xl font-semibold text-gray-800 mb-4">–ù–∞–π—Ç–∏ –º–æ–∏ –∑–∞–∫–∞–∑—ã</h2>
      <p class="text-gray-600 mb-6">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —É–∫–∞–∑–∞–ª–∏ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞</p>
      
      <form method="post" class="max-w-md mx-auto">
        {% csrf_token %}
        <div class="mb-4">
          <input type="tel" name="phone" placeholder="+7 (___) ___-__-__" value="{{ phone }}" required 
                 class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        </div>
        <button type="submit" class="w-full bg-blue-600 text-white font-semibold py-3 rounded-lg hover:bg-blue-700 transition">
          –ù–∞–π—Ç–∏ –∑–∞–∫–∞–∑—ã
        </button>
      </form>
      
      <div class="mt-6 border-t pt-6">
        <p class="text-sm text-gray-600 mb-4">–•–æ—Ç–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∑–∞–∫–∞–∑–æ–≤ –∏ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –ª–∏—á–Ω–æ–º—É –∫–∞–±–∏–Ω–µ—Ç—É?</p>
        <div class="flex flex-wrap justify-center gap-4">
          <a href="{% url 'accounts:login' %}" class="inline-block px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
            –í–æ–π—Ç–∏/–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
          </a>
        </div>
      </div>
    </div>
  </div>

  {% if orders %}
  <div class="bg-white rounded-lg shadow-md p-6">
    <h2 class="text-xl font-semibold mb-4 pb-2 border-b">–ù–∞–π–¥–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã</h2>
    
    <div class="overflow-x-auto">
      <table class="min-w-full bg-white">
        <thead>
          <tr class="bg-gray-100 border-b">
            <th class="py-3 px-4 text-left font-medium text-gray-700">‚Ññ –∑–∞–∫–∞–∑–∞</th>
            <th class="py-3 px-4 text-left font-medium text-gray-700">–î–∞—Ç–∞</th>
            <th class="py-3 px-4 text-left font-medium text-gray-700">–°—É–º–º–∞</th>
            <th class="py-3 px-4 text-left font-medium text-gray-700">–°—Ç–∞—Ç—É—Å</th>
            <th class="py-3 px-4 text-left font-medium text-gray-700">–î–µ—Ç–∞–ª–∏</th>
          </tr>
        </thead>
        <tbody>
          {% for order in orders %}
          <tr class="border-b hover:bg-gray-50">
            <td class="py-3 px-4 font-medium">{{ order.id }}</td>
            <td class="py-3 px-4">{{ order.created_at|date:"d.m.Y" }}</td>
            <td class="py-3 px-4">{{ order.total_amount }} ‚ÇΩ</td>
            <td class="py-3 px-4">
              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                {% if order.status == 'new' %}bg-blue-100 text-blue-800
                {% elif order.status == 'processing' %}bg-yellow-100 text-yellow-800
                {% elif order.status == 'shipped' %}bg-purple-100 text-purple-800
                {% elif order.status == 'delivered' %}bg-green-100 text-green-800
                {% elif order.status == 'cancelled' %}bg-red-100 text-red-800
                {% else %}bg-gray-100 text-gray-800{% endif %}">
                {{ order.get_status_display }}
              </span>
            </td>
            <td class="py-3 px-4">
              <button class="text-blue-600 hover:text-blue-800 font-medium text-sm order-details-btn" 
                data-order-id="{{ order.id }}">
                –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏
              </button>
            </td>
          </tr>
          <tr class="order-details-row hidden" id="details-{{ order.id }}">
            <td colspan="5" class="py-3 px-4 bg-gray-50">
              <div class="text-sm">
                <div class="font-medium mb-2">–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞ #{{ order.id }}</div>
                <div class="mb-2">
                  <span class="text-gray-600">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</span> 
                  {{ order.delivery_address }}
                </div>
                <div class="mb-3">
                  <span class="text-gray-600">–¢–µ–ª–µ—Ñ–æ–Ω:</span> 
                  {{ order.phone_number }}
                </div>
                
                <div class="font-medium mb-2">–¢–æ–≤–∞—Ä—ã:</div>
                <ul class="list-disc list-inside space-y-1 pl-2">
                  {% for item in order.orderitem_set.all %}
                  <li>
                    {{ item.product.name }} - {{ item.quantity }} —à—Ç. √ó {{ item.price }} ‚ÇΩ
                  </li>
                  {% endfor %}
                </ul>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="mt-6 text-center">
      <p class="text-sm text-gray-600 mb-3">–í–æ–π–¥–∏—Ç–µ –ø–æ —ç—Ç–æ–º—É –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞, —á—Ç–æ–±—ã –≤—Å–µ–≥–¥–∞ –∏–º–µ—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–≤–æ–∏–º –∑–∞–∫–∞–∑–∞–º</p>
      <a href="{% url 'accounts:login' %}?type=phone" class="inline-block py-2 px-4 bg-blue-600 text-white rounded hover:bg-blue-700">
        –í–æ–π—Ç–∏ —Å —ç—Ç–∏–º –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞
      </a>
    </div>
  </div>
  {% endif %}
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
    document.querySelectorAll('.order-details-btn').forEach(button => {
      button.addEventListener('click', function() {
        const orderId = this.getAttribute('data-order-id');
        const detailsRow = document.getElementById(`details-${orderId}`);
        detailsRow.classList.toggle('hidden');
        
        if (!detailsRow.classList.contains('hidden')) {
          this.textContent = '–°–∫—Ä—ã—Ç—å –¥–µ—Ç–∞–ª–∏';
        } else {
          this.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏';
        }
      });
    });
  });
</script>
{% endblock %}
